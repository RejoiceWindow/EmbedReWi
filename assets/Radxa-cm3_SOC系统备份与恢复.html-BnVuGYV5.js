import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as h,a as s,d as k,b as l,w as n,r as p,o as d,e}from"./app-DIMvcjhy.js";const r={},c={class:"table-of-contents"};function o(g,i){const a=p("router-link");return d(),h("div",null,[i[13]||(i[13]=s("h2",{id:"目录",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#目录"},[s("span",null,"目录")])],-1)),s("nav",c,[s("ul",null,[s("li",null,[l(a,{to:"#目录"},{default:n(()=>i[0]||(i[0]=[e("目录")])),_:1})]),s("li",null,[l(a,{to:"#方法一-整个硬盘复制与重写"},{default:n(()=>i[1]||(i[1]=[e("方法一:整个硬盘复制与重写")])),_:1}),s("ul",null,[s("li",null,[l(a,{to:"#_1-磁盘克隆"},{default:n(()=>i[2]||(i[2]=[e("1. 磁盘克隆")])),_:1})]),s("li",null,[l(a,{to:"#_2-烧写系统"},{default:n(()=>i[3]||(i[3]=[e("2. 烧写系统")])),_:1})])])]),s("li",null,[l(a,{to:"#方法二-文件覆盖"},{default:n(()=>i[4]||(i[4]=[e("方法二:文件覆盖")])),_:1}),s("ul",null,[s("li",null,[l(a,{to:"#_1-将安装好环境的部分系统文件放入压缩包"},{default:n(()=>i[5]||(i[5]=[e("1. 将安装好环境的部分系统文件放入压缩包")])),_:1})]),s("li",null,[l(a,{to:"#_2-通过网络、u-盘、usb-等方式将压缩包拷贝出来"},{default:n(()=>i[6]||(i[6]=[e("2. 通过网络、U 盘、USB 等方式将压缩包拷贝出来")])),_:1})]),s("li",null,[l(a,{to:"#_3-用-pc-传到新烧写系统的-cm3-中并解压到根目录"},{default:n(()=>i[7]||(i[7]=[e("3. 用 PC 传到新烧写系统的 CM3 中并解压到根目录")])),_:1})])])]),s("li",null,[l(a,{to:"#方法三-备份到镜像文件-自定义大小"},{default:n(()=>i[8]||(i[8]=[e("方法三：备份到镜像文件，自定义大小")])),_:1}),s("ul",null,[s("li",null,[l(a,{to:"#前提"},{default:n(()=>i[9]||(i[9]=[e("前提")])),_:1})]),s("li",null,[l(a,{to:"#总备份脚本"},{default:n(()=>i[10]||(i[10]=[e("总备份脚本")])),_:1})])])]),s("li",null,[l(a,{to:"#备份系统"},{default:n(()=>i[11]||(i[11]=[e("备份系统")])),_:1})]),s("li",null,[l(a,{to:"#再新方法"},{default:n(()=>i[12]||(i[12]=[e("再新方法")])),_:1})])])]),i[14]||(i[14]=k(`<blockquote><p>CM3 官方也出了备份系统方法，有兴趣的可以尝试一下：<a href="https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online" target="_blank" rel="noopener noreferrer">https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online</a></p></blockquote><h2 id="方法一-整个硬盘复制与重写" tabindex="-1"><a class="header-anchor" href="#方法一-整个硬盘复制与重写"><span>方法一:整个硬盘复制与重写</span></a></h2><p>参考：<a href="https://blog.51cto.com/u_15460722/4861190" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/u_15460722/4861190</a></p><blockquote><p>无论备份还是恢复，都需要保证 of 指向的文件或磁盘空间要大于 if 指向的内容<br> 查看磁盘：<a href="http://www.shbk.cn/qita/261232.html" target="_blank" rel="noopener noreferrer">http://www.shbk.cn/qita/261232.html</a></p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#硬盘的分区情况</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsblk</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#以GB方式查看</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">df</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#查看所有的硬盘文件系统</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">df</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-磁盘克隆" tabindex="-1"><a class="header-anchor" href="#_1-磁盘克隆"><span>1. 磁盘克隆</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#也就是把整个硬盘复制一份。当然你首先需要在计算机上在接上一块新硬盘，并让系统识别。</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#dd if=/dev/sda of=/dev/sdb​​</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#把硬盘上的内容全部备份到一个磁盘文件中​</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if=/dev/mmcblk0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of=linuxBackup20230131.img​​</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#也可以压缩一下：</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo gzip linuxBackup20230131.img #generates linuxBackup20230131.img.gz​​</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接备份在 SOC 要备份的硬盘不知道会不会形成循环，使文件很大<br> 新增硬盘：U 盘或者使用 PC 共享文件夹：共享文件夹</p><blockquote><p>共享文件夹方式备份，网速一般，磁盘读写速度一般，用时：15 分钟左右<br> 完整脚本：<a href="http://backupToImg.sh" target="_blank" rel="noopener noreferrer">backupToImg.sh</a></p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;+%Y-%m-%d %H:%M:%S&quot;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;~~~~~~~~~~~~~~~~~~~~备份开始~~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#让sudo命令生效</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rock</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -S</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shared</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 目标： //&lt;计算机IP&gt;/&lt;共享文件夹名&gt;    ，说明: / 不能 \\</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mount</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cifs</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> username=rewi,password=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> //10.162.130.10/share</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shared</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># shellcheck disable=SC2164</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shared</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> || </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">exit</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ls</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#把硬盘上的内容全部备份到一个磁盘文件中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> if=/dev/mmcblk0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of=linuxBackup20230201.img</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;+%Y-%m-%d %H:%M:%S&quot;</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;~~~~~~~~~~~~~~~~~~~~备份完成~~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#也可以压缩一下：generates xxx.img.xz</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo xz linuxBackup20230201.img</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#date &quot;+%Y-%m-%d %H:%M:%S&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#echo &quot;~~~~~~~~~~~~~~~~~~~~压缩完成~~~~~~~~~~~~~~~~~~~~~~~~~&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#清除</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#cd ..</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo umount shared</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo rm -rf shared</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>分区克隆</li></ol><blockquote><p>如果我们不想克隆整块磁盘，只想把某些存放数据的分区备份一下，你会需要克隆一个分区。正如预备知识所述，分区在 linux 下也是一个文件。<br> ​​dd if=/dev/sda1 of=~/part1.img​​<br> 也可以进行分区复制：<br> ​​dd if=/dev/hda1 of=/dev/hda3​​</p></blockquote><ol><li>从镜像文件恢复磁盘或分区</li></ol><blockquote><p>of 和 if 指向的文件名互换一下即可实现恢复。<br> ​dd if=linuxBackup20230131.img of=/dev/mmcblk0</p></blockquote><h3 id="_2-烧写系统" tabindex="-1"><a class="header-anchor" href="#_2-烧写系统"><span>2. 烧写系统</span></a></h3><blockquote><p>14.4G，用时：15 分钟左右</p></blockquote><ul><li>使用官方工具 RKDevTool 烧写</li></ul><h2 id="方法二-文件覆盖" tabindex="-1"><a class="header-anchor" href="#方法二-文件覆盖"><span>方法二:文件覆盖</span></a></h2><blockquote><p>参考：<a href="https://blog.csdn.net/sty1023750281/article/details/80877500" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/sty1023750281/article/details/80877500</a> &gt; <a href="https://blog.csdn.net/weixin_53064820/article/details/127755481" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_53064820/article/details/127755481</a></p></blockquote><h3 id="_1-将安装好环境的部分系统文件放入压缩包" tabindex="-1"><a class="header-anchor" href="#_1-将安装好环境的部分系统文件放入压缩包"><span>1. 将安装好环境的部分系统文件放入压缩包</span></a></h3><blockquote><p>完整脚本：-backupByTar.sh</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#压缩太慢: sudo tar -Jcvpf linuxBackup20230131.tar.xz --exclude=linuxBackup20230131.tar.xz --exclude=/boot --exclude=/dev --exclude=/mnt  --exclude=/proc --exclude=/sys --exclude=/media /</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cvpzf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linuxBackup20230131.tgz</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --exclude=linuxBackup20230131.tgz</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=/boot</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=/dev</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=/mnt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --exclude=/proc</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=/sys</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=/media</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-通过网络、u-盘、usb-等方式将压缩包拷贝出来" tabindex="-1"><a class="header-anchor" href="#_2-通过网络、u-盘、usb-等方式将压缩包拷贝出来"><span>2. 通过网络、U 盘、USB 等方式将压缩包拷贝出来</span></a></h3><h3 id="_3-用-pc-传到新烧写系统的-cm3-中并解压到根目录" tabindex="-1"><a class="header-anchor" href="#_3-用-pc-传到新烧写系统的-cm3-中并解压到根目录"><span>3. 用 PC 传到新烧写系统的 CM3 中并解压到根目录</span></a></h3><blockquote><p>耗时 13 分钟左右<br> 完整脚本：-recoveryByCover.bat</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:解压缩</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:压缩太慢:tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Jxvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linuxBackup20230131.tar.xz</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -C</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> devices</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> linuxBackup20230131.tgz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /home/rock/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">adb</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;cd /home/rock/ &amp;&amp; sudo tar xvpfz linuxBackup20230131.tgz -C / &amp;&amp; sudo rm -rf linuxBackup20230131.tgz&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="方法三-备份到镜像文件-自定义大小" tabindex="-1"><a class="header-anchor" href="#方法三-备份到镜像文件-自定义大小"><span>方法三：备份到镜像文件，自定义大小</span></a></h2><h3 id="前提" tabindex="-1"><a class="header-anchor" href="#前提"><span>前提</span></a></h3><p>一个分区完成的镜像，如（任意名字）：rk3566-cm3Debian.img<br> 分区参考：&lt;磁盘操作&gt;<br> 已经分区好的（文件系统分区 5G 左右）：X:\\Temp\\XGH\\cm3 待备份镜像</p><h3 id="总备份脚本" tabindex="-1"><a class="header-anchor" href="#总备份脚本"><span>总备份脚本</span></a></h3><p>挂载共享文件夹参考（剩余空间足够时可以不用挂载，但需要将备份镜像手动拷贝出来，挂载会降低一点点速度）：&lt;共享文件夹&gt;<br><code>mkBackupImg.sh</code></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 挂载一个保存镜像的磁盘（方便复制出来），挂载会降低一点点速度</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 如果核心板空间足够则不需要，备份好了通过网络传到电脑保存效果一样</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cd ~</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># mkdir share</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># sudo mount -t cifs -o username=rewi,password= //10.162.130.10/share ~/share</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cd ~/share</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装必要的包</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># parted &amp; kpartx：虚拟磁盘工具</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt-get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> parted</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kpartx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看 img 文件情况</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># sudo fdisk -l rk3566-cm3Debian.img</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> parted</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rk3566-cm3Debian.img</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> print</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看磁盘使用情况</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">df</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -Th</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将分区和 loop设备建立联系</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># -o （起始扇区 * 扇区大小）--sizelimit （扇区数量 * 扇区大小） 字节</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo losetup -f -o 16777216 --sizelimit 536870912 rk3566-cm3Debian.img</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#sudo losetup -f -o 553648128 --sizelimit 7515144192 rk3566-cm3Debian.img</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">loopdevice</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> losetup </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --show</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rk3566-cm3Debian.img\`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kpartx </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">-va</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $loopdevice</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -E</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;s/.*(loop[0-9])p.*/\\1/g&#39; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> head</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">\`</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/dev/mapper/</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">device</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">partBoot</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">device</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">p1&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">partRoot</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">device</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">p2&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看是否成功</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> losetup</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">lsblk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 挂载设备</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mount</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ext4</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $partRoot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /media/</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看挂载情况</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">df</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 将文件系统内容复制到挂载的镜像</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /media</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ls</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 备份文件系统 或者 增删改 文件系统中的内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> rsync</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -avxP</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/home/rock/share&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/sys&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/dev&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/boot&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/mnt&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/proc&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exclude=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;/media&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 过滤后创建空文件夹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mkdir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> boot</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mnt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> proc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> media</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 拷贝完成，卸载分区</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ~/share</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> umount</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /media</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 备份完成，卸载虚拟磁盘</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> kpartx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $loopdevice</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> losetup</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $loopdevice</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> losetup</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -l</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将备份完成的镜像，rk3566-cm3Debian.img 通过烧写工具下载到核心板即可</p><h2 id="备份系统" tabindex="-1"><a class="header-anchor" href="#备份系统"><span>备份系统</span></a></h2><h2 id="再新方法" tabindex="-1"><a class="header-anchor" href="#再新方法"><span>再新方法</span></a></h2><blockquote><p><a href="https://blog.csdn.net/Neutionwei/article/details/122669712" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/Neutionwei/article/details/122669712</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/Neutionwei/article/details/121886647" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/Neutionwei/article/details/121886647</a></p></blockquote><blockquote><p><a href="https://wiki.t-firefly.com/zh_CN/Firefly-Linux-Guide/manual_ubuntu.html" target="_blank" rel="noopener noreferrer">https://wiki.t-firefly.com/zh_CN/Firefly-Linux-Guide/manual_ubuntu.html</a></p></blockquote><blockquote><p><a href="https://wiki.t-firefly.com/zh_CN/ROC-RK3566-PC/" target="_blank" rel="noopener noreferrer">https://wiki.t-firefly.com/zh_CN/ROC-RK3566-PC/</a></p></blockquote><blockquote><p><a href="https://blog.csdn.net/weixin_39510813/article/details/117824965" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/weixin_39510813/article/details/117824965</a></p></blockquote>`,40))])}const A=t(r,[["render",o]]),m=JSON.parse('{"path":"/OS/Radxa/Radxa-cm3_SOC%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D.html","title":"radxa-cm3_SOC系统备份与恢复","lang":"zh-CN","frontmatter":{"title":"radxa-cm3_SOC系统备份与恢复","date":"2024-06-09T23:30:00.000Z","tags":["radxa-cm3","ARM","Linux"],"categories":["OS"],"description":"目录 CM3 官方也出了备份系统方法，有兴趣的可以尝试一下：https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online 方法一:整个硬盘复制与重写 参考：https://blog.51cto.com/u_15460722/4861190 无论备份还是恢复，都需...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"radxa-cm3_SOC系统备份与恢复\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-06-09T23:30:00.000Z\\",\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"ReWi\\",\\"url\\":\\"https://gitee.com/re-wi\\",\\"email\\":\\"RejoiceWindow@yeah.net\\"},{\\"@type\\":\\"Person\\",\\"name\\":\\"ReWi\\",\\"url\\":\\"https://github.com/Re-Wi/\\",\\"email\\":\\"RejoiceWindow@yeah.net\\"},{\\"@type\\":\\"Person\\",\\"name\\":\\"RejoiceWindow\\"}]}"],["meta",{"property":"og:url","content":"https://em.rewi.xyz/OS/Radxa/Radxa-cm3_SOC%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D.html"}],["meta",{"property":"og:site_name","content":"EmbedReWi"}],["meta",{"property":"og:title","content":"radxa-cm3_SOC系统备份与恢复"}],["meta",{"property":"og:description","content":"目录 CM3 官方也出了备份系统方法，有兴趣的可以尝试一下：https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online 方法一:整个硬盘复制与重写 参考：https://blog.51cto.com/u_15460722/4861190 无论备份还是恢复，都需..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"ARM"}],["meta",{"property":"article:tag","content":"radxa-cm3"}],["meta",{"property":"article:published_time","content":"2024-06-09T23:30:00.000Z"}],["link",{"rel":"alternate","type":"application/rss+xml","href":"https://em.rewi.xyz/rss.xml","title":"EmbedReWi RSS Feed"}]]},"git":{},"readingTime":{"minutes":4.2,"words":1259},"filePathRelative":"OS/Radxa/Radxa-cm3_SOC系统备份与恢复.md","localizedDate":"2024年6月10日","excerpt":"<h2>目录</h2>\\n\\n<blockquote>\\n<p>CM3 官方也出了备份系统方法，有兴趣的可以尝试一下：<a href=\\"https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://docs.radxa.com/compute-module/cm3/mp-deployment/backup?method=online</a></p>\\n</blockquote>\\n<h2>方法一:整个硬盘复制与重写</h2>","autoDesc":true}');export{A as comp,m as data};
